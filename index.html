<!DOCTYPE html>
<html>
  <head>    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="icon" type="image/JPG" href="./static/images/logo.JPG">
    <link rel="stylesheet" href="./static/css/styles.css" />    <!-- SweetAlert2 CSS and JS from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-material-ui@5/material-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Custom login messages handler -->
    <script src="./js/login-messages.js"></script>
    <title>Reg - Maintainance Management System</title>
    
  </head>
  <body class="signin-body">
    <div class="container">
      <div class="form-container sign-in-container">
        <form action="loginscript.php" method="POST" id="loginForm">
          <div class="form-header">
            <img src="./static/images/logo.JPG" alt="Reg Logo" class="logo">
            <h1>Sign In</h1>
          </div>

          <!-- User Type Selection -->

          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" name="email" id="emailInput" placeholder="Username or Email" required />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" name="password" placeholder="Password" required />
            <i class="fas fa-eye password-toggle"></i>
          </div>
          <a href="./reset_password.html" class="forgot-password">Forgot your password?</a>

          <!-- Error Message Display -->
          <div id="errorMessage" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText"></span>
          </div>

          <!-- Hidden field to track user type -->
          <input type="hidden" name="user_type" id="userType" value="staff">

          <button type="submit" name="login">
            <span>Sign In</span>
            <div class="spinner"></div>
          </button>
        </form>
      </div>      
      <div class="overlay-container">
        <div class="overlay">
          <div class="overlay-panel">
            <h1>New to REG MIS?</h1>
            <p>Contact your system administrator to create an account and start managing institutional equipment, track their usage, and monitor expiry or warranty periods in an efficient and reliable way.</p>
            <div class="contact-info">
              <p><i class="fas fa-envelope"></i> admin@reg.rw</p>
              <p><i class="fas fa-phone"></i> +250 785 750 117</p>
            </div>
          </div>
        </div>
      </div>
    </div>    <script>
      // User type selection handling
      document.addEventListener('DOMContentLoaded', function() {
        const userTypeOptions = document.querySelectorAll('.user-type-option');
        const userTypeInput = document.getElementById('userType');
        const emailInput = document.getElementById('emailInput');
        const studentRegisterLink = document.getElementById('studentRegisterLink');

        userTypeOptions.forEach(option => {
          option.addEventListener('click', function() {
            // Remove active class from all options
            userTypeOptions.forEach(opt => opt.classList.remove('active'));

            // Add active class to clicked option
            this.classList.add('active');

            // Update hidden input value
            const userType = this.dataset.type;
            userTypeInput.value = userType;
          });
        });
      });

      // Form submission handling
      document.querySelector('form').addEventListener('submit', function(e) {
        const usernameInput = document.getElementById('emailInput');
        const passwordInput = document.querySelector('input[name="password"]');
        const submitBtn = this.querySelector('button[type="submit"]');
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (!username) {
          e.preventDefault();
          Swal.fire({
            icon: 'warning',
            title: 'Username or Email Required',
            text: 'Please enter your username or email.',
            confirmButtonText: 'OK',
            confirmButtonColor: '#2563eb'
          });
          usernameInput.focus();
          return;
        }
        
        if (!password) {
          e.preventDefault();
          Swal.fire({
            icon: 'warning',
            title: 'Password Required',
            text: 'Please enter your password.',
            confirmButtonText: 'OK',
            confirmButtonColor: '#2563eb'
          });
          passwordInput.focus();
          return;
        }

        // Add loading state
        submitBtn.classList.add('loading');
      });

      // Check for error messages from PHP
      document.addEventListener('DOMContentLoaded', function() {
        // Check URL parameters for error messages
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        const success = urlParams.get('success');

        if (error) {
          const decodedError = decodeURIComponent(error);
          
          // Handle specific error types
          if (decodedError === 'incorrect_password') {
            Swal.fire({
              icon: 'error',
              title: 'Login Failed',
              html: '<p>The username, email, or password you entered is incorrect.</p><p style="font-size: 0.9rem; color: #666; margin-top: 10px;">Please check your credentials and try again.</p>',
              confirmButtonText: 'Try Again',
              confirmButtonColor: '#2563eb',
              didClose: () => {
                document.getElementById('emailInput').focus();
                document.getElementById('emailInput').value = '';
                document.querySelector('input[name="password"]').value = '';
              }
            });
          } else {
            // General error message
            Swal.fire({
              icon: 'error',
              title: 'Login Failed',
              text: decodedError,
              confirmButtonText: 'OK',
              confirmButtonColor: '#2563eb'
            });
          }
          
          // Clear the error from URL
          window.history.replaceState({}, document.title, window.location.pathname);
        } else if (success) {
          Swal.fire({
            icon: 'success',
            title: 'Success',
            text: decodeURIComponent(success),
            confirmButtonText: 'OK',
            confirmButtonColor: '#2563eb'
          });
          
          // Clear the success from URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      });

      // Password toggle with animation
      document.querySelector('.password-toggle').addEventListener('click', function() {
        const passwordInput = document.querySelector('input[name="password"]');
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.classList.toggle('fa-eye');
        this.classList.toggle('fa-eye-slash');

        this.style.transform = 'scale(1.2)';
        setTimeout(() => {
          this.style.transform = 'scale(1)';
        }, 150);
      });
    </script>
  </body>
</html>
